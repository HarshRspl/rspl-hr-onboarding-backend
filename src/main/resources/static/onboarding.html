<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RSPL Onboarding Portal</title>
  https://cdn.tailwindcss.com</script>
  <style>
    body { font-family: "Segoe UI", sans-serif; }
    .gradient-bg { background: linear-gradient(135deg, #1e3a5f 0%, #3b82f6 100%); }
    .step-active { background: #3b82f6; color: white; }
    .step-pending{ background: #e2e8f0; color: #94a3b8; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
    .fade-in { animation: fadeIn 0.3s ease; }
    .input-field {
      width: 100%;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 10px 14px;
      font-size: 14px;
      outline: none;
      transition: border-color 0.2s;
    }
    .input-field:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }
    .section-card {
      background: white;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.06);
    }
  </style>
</head>

<body class="bg-gray-50 min-h-screen">

  <!-- HEADER -->
  <nav class="gradient-bg text-white px-6 py-4 flex items-center gap-4 shadow-lg">
    <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center font-bold text-xl">R</div>
    <div>
      <div class="font-bold text-lg">RSPL Health</div>
      <div class="text-xs text-blue-200">Pre-Onboarding Portal</div>
    </div>
  </nav>

  <div class="max-w-3xl mx-auto p-6">

    <!-- LOADING -->
    <div id="screen-loading" class="text-center py-20">
      <div class="inline-block w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"></div>
      <p class="text-gray-500">Verifying your link...</p>
    </div>

    <!-- INVALID -->
    <div id="screen-invalid" class="hidden fade-in">
      <div class="section-card text-center py-12">
        <div class="text-6xl mb-4">‚ùå</div>
        <h2 class="text-2xl font-bold text-gray-800 mb-2">Link Invalid or Expired</h2>
        <p class="text-gray-500 mb-6">This onboarding link is not valid or has expired (links are valid for 7 days).</p>
        <p class="text-gray-500">Please contact HR to get a new link.</p>
        <div class="mt-6 bg-blue-50 rounded-lg p-4 text-sm text-blue-700">
          üìû HR Contact: hr@rspl.com<br/>9811001100
        </div>
      </div>
    </div>

    <!-- WELCOME -->
    <div id="screen-welcome" class="hidden fade-in">
      <div class="section-card text-center py-10">
        <div class="text-5xl mb-4">üëã</div>
        <h2 class="text-3xl font-bold text-gray-800 mb-2">Welcome, <span id="welcome-name"></span>!</h2>
        <p class="text-blue-600 font-semibold mb-1" id="welcome-designation"></p>
        <p class="text-gray-500 mb-8">Please complete your onboarding formalities.<br/>This should take about 10-15 minutes.</p>

        <div class="flex justify-center items-center gap-2 mb-8">
          <div class="flex flex-col items-center">
            <div class="w-10 h-10 rounded-full step-active flex items-center justify-center font-bold text-sm">1</div>
            <span class="text-xs text-gray-500 mt-1">Personal</span>
          </div>
          <div class="w-10 h-px bg-gray-300"></div>
          <div class="flex flex-col items-center">
            <div class="w-10 h-10 rounded-full step-pending flex items-center justify-center font-bold text-sm">2</div>
            <span class="text-xs text-gray-500 mt-1">Address</span>
          </div>
          <div class="w-10 h-px bg-gray-300"></div>
          <div class="flex flex-col items-center">
            <div class="w-10 h-10 rounded-full step-pending flex items-center justify-center font-bold text-sm">3</div>
            <span class="text-xs text-gray-500 mt-1">Bank</span>
          </div>
          <div class="w-10 h-px bg-gray-300"></div>
          <div class="flex flex-col items-center">
            <div class="w-10 h-10 rounded-full step-pending flex items-center justify-content-center font-bold text-sm">4</div>
            <span class="text-xs text-gray-500 mt-1">Nominee</span>
          </div>
        </div>

        <button onclick="showScreen('screen-form')"
          class="gradient-bg text-white px-10 py-3 rounded-xl font-bold text-lg hover:opacity-90 transition shadow-lg">
          Start Onboarding ‚Üí
        </button>
      </div>
    </div>

    <!-- SUBMITTED -->
    <div id="screen-submitted" class="hidden fade-in">
      <div class="section-card text-center py-12">
        <div class="text-5xl mb-4">‚úÖ</div>
        <h2 class="text-2xl font-bold text-gray-800 mb-2">Form Already Submitted!</h2>
        <p class="text-gray-500 mb-6">You have already completed the onboarding form.</p>
        <div id="status-timeline" class="text-left max-w-sm mx-auto"></div>
      </div>
    </div>

    <!-- FORM -->
    <div id="screen-form" class="hidden fade-in">
      <div class="mb-6">
        <h2 class="text-2xl font-bold text-gray-800">Joining Form</h2>
        <p class="text-gray-500 text-sm">All fields are mandatory unless marked optional</p>
      </div>

      <!-- SECTION 1 -->
      <div class="section-card">
        <h3 class="text-lg font-bold text-gray-700 mb-4">Personal Information</h3>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">Full Name</label>
            <input class="input-field bg-gray-50" id="f-name" readonly />
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">Father's Name *</label>
            <input class="input-field" id="f-fathers-name" placeholder="Father's full name" />
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">Date of Birth *</label>
            <input type="date" class="input-field" id="f-dob" max="" />
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">Gender *</label>
            <select class="input-field" id="f-gender">
              <option value="">Select Gender</option>
              <option>Male</option>
              <option>Female</option>
              <option>Other</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">Marital Status *</label>
            <select class="input-field" id="f-marital">
              <option value="">Select Status</option>
              <option>Single</option>
              <option>Married</option>
              <option>Divorced</option>
              <option>Widowed</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">Blood Group *</label>
            <select class="input-field" id="f-blood">
              <option value="">Select Blood Group</option>
              <option>A+</option><option>A-</option>
              <option>B+</option><option>B-</option>
              <option>AB+</option><option>AB-</option>
              <option>O+</option><option>O-</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">Highest Education *</label>
            <select class="input-field" id="f-education">
              <option value="">Select Education</option>
              <option>10th Pass</option>
              <option>12th Pass</option>
              <option>Diploma</option>
              <option>Graduate (B.A / B.Sc / B.Com)</option>
              <option>Graduate (B.Tech / B.E)</option>
              <option>Post Graduate</option>
              <option>MBA</option>
              <option>PhD</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">PAN Number *</label>
            <input class="input-field" id="f-pan" placeholder="ABCDE1234F" maxlength="10" style="text-transform:uppercase" />
          </div>
        </div>
      </div>

      <!-- ‚úÖ UAN YES/NO -->
      <div class="section-card">
        <h3 class="text-lg font-bold text-gray-700 mb-4">PF / UAN Details</h3>

        <label class="block text-sm font-semibold text-gray-600 mb-2">Do you already have UAN?</label>

        <div class="flex gap-6 items-center mb-4">
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="radio" name="uanAvailable" value="YES" onchange="toggleUan()">
            <span class="text-sm text-gray-700">Yes</span>
          </label>

          <label class="flex items-center gap-2 cursor-pointer">
            <input type="radio" name="uanAvailable" value="NO" onchange="toggleUan()" checked>
            <span class="text-sm text-gray-700">No</span>
          </label>
        </div>

        <div id="uan-yes-box" class="hidden">
          <label class="block text-sm font-semibold text-gray-600 mb-1">UAN Number (12 digits)</label>
          <input class="input-field" id="f-uan" maxlength="12" placeholder="Enter your 12-digit UAN"
                 oninput="this.value=this.value.replace(/\\D/g,'');">
        </div>

        <div id="uan-no-box" class="bg-blue-50 border border-blue-100 rounded-lg p-4">
          <p class="text-sm text-blue-800 font-semibold mb-2">No UAN? Generate & activate UAN easily</p>
          <p class="text-xs text-blue-700 mb-3">Watch the official EPFO guide and then proceed.</p>
          https://www.youtube.com/watch?v=vw3k-w_3g1I
            ‚ñ∂ Official EPFO UAN Guide (YouTube)
          </a>
        </div>
      </div>

      <!-- SECTION 2 -->
      <div class="section-card">
        <h3 class="text-lg font-bold text-gray-700 mb-4">Address Details</h3>
        <div class="grid grid-cols-2 gap-4">
          <div class="col-span-2">
            <label class="block text-sm font-semibold text-gray-600 mb-1">Permanent Address *</label>
            <textarea class="input-field" id="f-address" rows="3" placeholder="House No, Street, Area, Landmark"></textarea>
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">District *</label>
            <input class="input-field" id="f-district" placeholder="District" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">State *</label>
            <input class="input-field" id="f-state" placeholder="State" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">PIN Code *</label>
            <input class="input-field" id="f-pin" placeholder="6-digit PIN" maxlength="6" />
          </div>
        </div>
      </div>

      <!-- SECTION 3 -->
      <div class="section-card">
        <h3 class="text-lg font-bold text-gray-700 mb-4">Bank Details</h3>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">Bank Name *</label>
            <input class="input-field" id="f-bank-name" placeholder="e.g. State Bank of India" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">Account Number *</label>
            <input class="input-field" id="f-account" placeholder="Account Number" maxlength="20" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">IFSC Code *</label>
            <input class="input-field" id="f-ifsc" placeholder="SBIN0001234" maxlength="11" style="text-transform:uppercase" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">Branch Name *</label>
            <input class="input-field" id="f-branch" placeholder="Branch name" />
          </div>
        </div>
      </div>

      <!-- SECTION 4 -->
      <div class="section-card">
        <h3 class="text-lg font-bold text-gray-700 mb-4">Nominee Details</h3>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">Nominee Name *</label>
            <input class="input-field" id="f-nominee-name" placeholder="Full name" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">Relation *</label>
            <select class="input-field" id="f-nominee-relation">
              <option value="">Select Relation</option>
              <option>Father</option><option>Mother</option>
              <option>Spouse</option><option>Son</option>
              <option>Daughter</option><option>Brother</option>
              <option>Sister</option><option>Other</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">Nominee Date of Birth *</label>
            <input type="date" class="input-field" id="f-nominee-dob" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">Nominee Address *</label>
            <input class="input-field" id="f-nominee-address" placeholder="Address" />
          </div>
        </div>
      </div>

      <!-- ‚úÖ DOCUMENT UPLOADS -->
      <div class="section-card">
        <h3 class="text-lg font-bold text-gray-700 mb-4">üìé Upload Documents</h3>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">Aadhaar (PDF/JPG/PNG)</label>
            <input type="file" id="doc-aadhaar" accept=".pdf,.jpg,.jpeg,.png" class="input-field">
            <button type="button" class="mt-2 w-full bg-blue-600 text-white py-2 rounded-lg text-sm font-semibold"
                    onclick="uploadDoc('AADHAAR','doc-aadhaar')">Upload Aadhaar</button>
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">PAN (PDF/JPG/PNG)</label>
            <input type="file" id="doc-pan" accept=".pdf,.jpg,.jpeg,.png" class="input-field">
            <button type="button" class="mt-2 w-full bg-blue-600 text-white py-2 rounded-lg text-sm font-semibold"
                    onclick="uploadDoc('PAN','doc-pan')">Upload PAN</button>
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">Bank Proof (PDF/JPG/PNG)</label>
            <input type="file" id="doc-bank" accept=".pdf,.jpg,.jpeg,.png" class="input-field">
            <button type="button" class="mt-2 w-full bg-blue-600 text-white py-2 rounded-lg text-sm font-semibold"
                    onclick="uploadDoc('BANK_PROOF','doc-bank')">Upload Bank Proof</button>
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">Photo (JPG/PNG)</label>
            <input type="file" id="doc-photo" accept=".jpg,.jpeg,.png" class="input-field">
            <button type="button" class="mt-2 w-full bg-blue-600 text-white py-2 rounded-lg text-sm font-semibold"
                    onclick="uploadDoc('PHOTO','doc-photo')">Upload Photo</button>
          </div>
        </div>

        <div class="mt-4 bg-gray-50 border rounded-lg p-4">
          <label class="block text-sm font-semibold text-gray-600 mb-1">Education / Experience (multiple files)</label>
          <input type="file" id="doc-edu-exp" multiple accept=".pdf,.jpg,.jpeg,.png" class="input-field">
          <button type="button" class="mt-2 w-full bg-blue-700 text-white py-2 rounded-lg text-sm font-semibold"
                  onclick="uploadMultiple('EDU_EXP','doc-edu-exp')">Upload Education/Experience</button>
        </div>

        <div class="mt-4 flex items-center gap-2">
          <button type="button" class="bg-gray-900 text-white px-4 py-2 rounded-lg text-sm font-semibold"
                  onclick="loadDocs()">Refresh Uploaded List</button>
        </div>

        <div id="docs-list" class="mt-4 text-sm text-gray-700"></div>
      </div>

      <!-- CONSENT -->
      <div class="section-card">
        <label class="flex items-start gap-3 cursor-pointer">
          <input type="checkbox" id="f-consent" class="mt-1 w-4 h-4 rounded border-gray-300 text-blue-600" />
          <span class="text-sm text-gray-600">
            I hereby declare that all the information furnished above is true and correct to the best of my knowledge.
          </span>
        </label>
      </div>

      <div id="form-error" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4 text-sm"></div>

      <button id="submit-btn" onclick="submitForm()"
        class="w-full gradient-bg text-white py-4 rounded-xl font-bold text-lg hover:opacity-90 transition shadow-lg">
        Submit Onboarding Form ‚Üí
      </button>

    </div>

    <!-- SUCCESS -->
    <div id="screen-success" class="hidden fade-in">
      <div class="section-card text-center py-12">
        <div class="text-6xl mb-4">üéâ</div>
        <h2 class="text-3xl font-bold text-gray-800 mb-2">Form Submitted!</h2>
        <p class="text-gray-500 mb-6">
          Your joining form has been submitted successfully.<br/>
          Your HR team will review and get back to you soon.
        </p>
      </div>
    </div>

  </div>

  <!-- TOAST -->
  <div id="toast" class="fixed bottom-6 right-6 hidden z-50">
    <div class="bg-gray-900 text-white px-6 py-3 rounded-xl shadow-2xl text-sm font-semibold"></div>
  </div>

  <script>
    const API = "https://rspl-hr-onboarding-backend-production.up.railway.app/api";
    let TOKEN = null;
    let CANDIDATE = null;

    function getTokenFromURL() {
      const params = new URLSearchParams(window.location.search);
      return params.get("token");
    }

    function showScreen(id) {
      ["screen-loading","screen-invalid","screen-welcome","screen-form","screen-success","screen-submitted"]
        .forEach(s => document.getElementById(s).classList.add("hidden"));
      document.getElementById(id).classList.remove("hidden");
    }

    function showToast(msg, color = "green") {
      const colors = { green: "bg-green-600", red: "bg-red-600", blue: "bg-blue-600" };
      const t = document.getElementById("toast");
      const box = t.querySelector("div");
      box.className = `${colors[color]} text-white px-6 py-3 rounded-xl shadow-2xl text-sm font-semibold`;
      box.textContent = msg;
      t.classList.remove("hidden");
      setTimeout(() => t.classList.add("hidden"), 3500);
    }

    // ‚úÖ UAN toggle
    function toggleUan() {
      const selected = document.querySelector('input[name="uanAvailable"]:checked')?.value || "NO";
      const yesBox = document.getElementById("uan-yes-box");
      const noBox  = document.getElementById("uan-no-box");

      if (selected === "YES") {
        yesBox.classList.remove("hidden");
        noBox.classList.add("hidden");
      } else {
        yesBox.classList.add("hidden");
        noBox.classList.remove("hidden");
        const u = document.getElementById("f-uan");
        if (u) u.value = "";
      }
    }

    // DOB max = 18 years ago
    const maxDob = new Date();
    maxDob.setFullYear(maxDob.getFullYear() - 18);
    document.getElementById("f-dob").max = maxDob.toISOString().split("T")[0];

    async function init() {
      TOKEN = getTokenFromURL();
      if (!TOKEN) { showScreen("screen-invalid"); return; }

      try {
        const res = await fetch(`${API}/candidate/verify-token?token=${TOKEN}`);
        const data = await res.json();

        if (!data.success) { showScreen("screen-invalid"); return; }

        CANDIDATE = data.data;
        document.getElementById("f-name").value = CANDIDATE.employeeName;
        document.getElementById("welcome-name").textContent = CANDIDATE.employeeName;
        document.getElementById("welcome-designation").textContent = CANDIDATE.designation || "";

        const status = CANDIDATE.joiningStatus;
        if (["FORM_SUBMITTED","SIGNED","APPROVED","REJECTED"].includes(status)) {
          showScreen("screen-submitted");
        } else {
          showScreen("screen-welcome");
        }
      } catch (e) {
        showScreen("screen-invalid");
      }
    }

    function showError(msg) {
      const el = document.getElementById("form-error");
      el.textContent = "‚ö†Ô∏è " + msg;
      el.classList.remove("hidden");
      setTimeout(() => el.classList.add("hidden"), 5000);
    }

    function validateForm() {
      const required = [
        ["f-fathers-name", "Father's Name"],
        ["f-dob", "Date of Birth"],
        ["f-gender", "Gender"],
        ["f-marital", "Marital Status"],
        ["f-blood", "Blood Group"],
        ["f-education", "Highest Education"],
        ["f-pan", "PAN Number"],
        ["f-address", "Permanent Address"],
        ["f-district", "District"],
        ["f-state", "State"],
        ["f-pin", "PIN Code"],
        ["f-bank-name", "Bank Name"],
        ["f-account", "Account Number"],
        ["f-ifsc", "IFSC Code"],
        ["f-branch", "Branch Name"],
        ["f-nominee-name", "Nominee Name"],
        ["f-nominee-relation","Nominee Relation"],
        ["f-nominee-dob", "Nominee Date of Birth"],
        ["f-nominee-address","Nominee Address"]
      ];

      for (const [id, label] of required) {
        const el = document.getElementById(id);
        if (!el || !el.value.trim()) {
          showError(`Please fill: ${label}`);
          return false;
        }
      }

      const pan = document.getElementById("f-pan").value.toUpperCase();
      if (!/^[A-Z]{5}[0-9]{4}[A-Z]$/.test(pan)) {
        showError("Invalid PAN format. Expected: ABCDE1234F");
        return false;
      }

      const ifsc = document.getElementById("f-ifsc").value.toUpperCase();
      if (!/^[A-Z]{4}0[A-Z0-9]{6}$/.test(ifsc)) {
        showError("Invalid IFSC format. Expected: SBIN0001234");
        return false;
      }

      const pin = document.getElementById("f-pin").value;
      if (!/^\d{6}$/.test(pin)) {
        showError("PIN Code must be exactly 6 digits");
        return false;
      }

      // ‚úÖ UAN validation only if YES
      const uanAvailable = document.querySelector('input[name="uanAvailable"]:checked')?.value || "NO";
      if (uanAvailable === "YES") {
        const uanNo = (document.getElementById("f-uan").value || "").trim();
        if (!/^\d{12}$/.test(uanNo)) {
          showError("UAN must be exactly 12 digits");
          return false;
        }
      }

      if (!document.getElementById("f-consent").checked) {
        showError("Please accept the declaration to proceed");
        return false;
      }

      return true;
    }

    async function submitForm() {
      if (!validateForm()) return;

      const btn = document.getElementById("submit-btn");
      btn.disabled = true;
      btn.textContent = "Submitting...";

      const uanAvailable = document.querySelector('input[name="uanAvailable"]:checked')?.value || "NO";
      const uanNo = (uanAvailable === "YES") ? (document.getElementById("f-uan").value || "").trim() : "";

      const payload = {
        token: TOKEN,
        fathersName: document.getElementById("f-fathers-name").value.trim(),
        dob: document.getElementById("f-dob").value,
        gender: document.getElementById("f-gender").value,
        maritalStatus: document.getElementById("f-marital").value,
        bloodGroup: document.getElementById("f-blood").value,
        higherEducation: document.getElementById("f-education").value,
        panCardNo: document.getElementById("f-pan").value.toUpperCase(),
        permanentAddress: document.getElementById("f-address").value.trim(),
        district: document.getElementById("f-district").value.trim(),
        state: document.getElementById("f-state").value.trim(),
        pinCode: document.getElementById("f-pin").value.trim(),
        bankName: document.getElementById("f-bank-name").value.trim(),
        bankAccountNo: document.getElementById("f-account").value.trim(),
        ifscCode: document.getElementById("f-ifsc").value.toUpperCase(),
        branchName: document.getElementById("f-branch").value.trim(),
        nomineeName: document.getElementById("f-nominee-name").value.trim(),
        nomineeRelation: document.getElementById("f-nominee-relation").value,
        nomineeDob: document.getElementById("f-nominee-dob").value,
        nomineeAddress: document.getElementById("f-nominee-address").value.trim(),

        // ‚úÖ NEW UAN fields
        uanAvailable: uanAvailable,
        uanNo: uanNo
      };

      try {
        const res = await fetch(`${API}/candidate/submit-form`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        const data = await res.json();

        if (data.success) {
          showToast("Form submitted successfully!", "green");
          showScreen("screen-success");
        } else {
          showError(data.message || "Submission failed. Please try again.");
          btn.disabled = false;
          btn.textContent = "Submit Onboarding Form ‚Üí";
        }
      } catch (e) {
        showToast("Submission failed (network). Try again.", "red");
        btn.disabled = false;
        btn.textContent = "Submit Onboarding Form ‚Üí";
      }
    }

    // ‚úÖ Upload Single Document
    async function uploadDoc(docType, inputId) {
      const fileInput = document.getElementById(inputId);
      if (!fileInput || !fileInput.files || fileInput.files.length === 0) {
        showToast("Please choose a file first", "red");
        return;
      }

      const file = fileInput.files[0];
      const fd = new FormData();
      fd.append("token", TOKEN);
      fd.append("docType", docType);
      fd.append("file", file);

      try {
        const res = await fetch(`${API}/candidate/documents/upload`, { method: "POST", body: fd });
        const data = await res.json();
        if (data.success) {
          showToast(`${docType} uploaded`, "green");
          fileInput.value = "";
          await loadDocs();
        } else {
          showToast(data.message || "Upload failed", "red");
        }
      } catch (e) {
        showToast("Upload error: " + e.message, "red");
      }
    }

    // ‚úÖ Upload Multiple (Education/Experience)
    async function uploadMultiple(docType, inputId) {
      const fileInput = document.getElementById(inputId);
      if (!fileInput || !fileInput.files || fileInput.files.length === 0) {
        showToast("Please choose one or more files", "red");
        return;
      }

      try {
        for (const file of fileInput.files) {
          const fd = new FormData();
          fd.append("token", TOKEN);
          fd.append("docType", docType);
          fd.append("file", file);

          const res = await fetch(`${API}/candidate/documents/upload`, { method: "POST", body: fd });
          const data = await res.json();
          if (!data.success) {
            showToast(`Upload failed for ${file.name}`, "red");
            return;
          }
        }
        showToast("Education/Experience uploaded", "green");
        fileInput.value = "";
        await loadDocs();
      } catch (e) {
        showToast("Upload error: " + e.message, "red");
      }
    }

    // ‚úÖ List uploaded docs
    async function loadDocs() {
      try {
        const res = await fetch(`${API}/candidate/documents/list?token=${TOKEN}`);
        const data = await res.json();

        if (!data.success) {
          document.getElementById("docs-list").innerHTML = "Unable to load documents";
          return;
        }

        const rows = (data.data || []).map(d => `
          <div class="flex items-center justify-between bg-gray-50 border rounded-lg px-3 py-2 mb-2">
            <div>
              <div class="font-semibold">${d.docType}</div>
              <div class="text-xs text-gray-500">${d.originalName} ‚Ä¢ ${Math.round((d.fileSize||0)/1024)} KB</div>
            </div>
            ${API}/candidate/documents/download/${d.id}
              Download
            </a>
          </div>
        `).join("");

        document.getElementById("docs-list").innerHTML = rows || "No documents uploaded yet.";
      } catch (e) {
        document.getElementById("docs-list").innerHTML = "Error loading docs: " + e.message;
      }
    }

    init();
  </script>

</body>
</html>
